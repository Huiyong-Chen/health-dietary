# **项目总纲与行动蓝图：Health-Dietary (健康饮食)**

## **文档目的**

本文档旨在全面总结“健康饮食”项目的最终技术架构、当前开发进度，并为下一阶段的工作提供清晰的路线图。它将作为所有开发人员（包括 AI 编程助手）的核心参考指南，以确保项目开发的一致性与高质量。

---

## **第一部分：最终技术栈选型**

我们确立了一套现代化、类型安全且高性能的全栈技术体系。

- **1.1. 全局与工程化 (Monorepo Core)**
  - **项目管理:** `pnpm workspace` - 管理多包 (`apps` & `packages`) 的 Monorepo 结构。
  - **语言:** `TypeScript` - 全栈使用，源文件采用 `.mts` 扩展名，遵循严格的类型检查。
  - **模块系统:** `ESM` (ECMAScript Modules) - 全局采用 `"type": "module"` 标准。
  - **代码规范:** `ESLint` (扁平化配置) + `Prettier`，实现了“根配置 + 子项目扩展”的分层管理模式。
  - **构建/运行工具:** `tsdown` (库/后端编译), `tsx` (开发时运行), `Vite` (前端), `concurrently` (总控)。
  - **路径别名:** 通过根 `tsconfig.base.json` 和 `vite-tsconfig-paths` 插件，实现了 `@api/*` 等简洁的模块导入路径。

- **1.2. 后端 (Backend - `@health-dietary/server`)**
  - **Web 框架:** `Hono` - 轻量、超快速的 Web 框架。
  - **API 框架:** `tRPC` - 实现端到端类型安全，无需代码生成。
  - **数据库 ORM:** `Prisma` - 提供类型安全的数据库访问和迁移系统。
  - **数据库:** `SQLite` - 用于本地开发的轻量级文件型数据库。
  - **环境变量:** `dotenv-cli` - 确保脚本能正确加载 `.env` 文件。

- **1.3. 共享库 (Shared Packages - `@health-dietary/api`)**
  - **核心职责:** 作为前后端的“契约”，定义 tRPC 的 `appRouter` 和所有共享 API 类型。
  - **解耦方式:** 通过 tRPC 的 `Context` 机制，将 API 的“定义”与后端的“实现”完全解耦。

- **1.4. 前端 (Frontend - `@health-dietary/client-react` & `client-vue`)**
  - **框架:** `React` 和 `Vue` - 双版本实现。
  - **异步状态管理:**
    - **React:** `@tanstack/react-query` (通过官方深度集成的 `@trpc/react-query` 包使用)。
    - **Vue:** `@tanstack/vue-query` (与 `@trpc/client` 核心库组合使用)。

---

## **第二部分：当前项目进度与状态**

我们已成功完成了项目的“0 到 1”阶段，即基础设施搭建、核心技术选型与配置，以及全链路的技术验证。

- **2.1. 已完成的核心任务:**
  1.  **Monorepo 架构搭建:** 项目结构完全建立，统一的、分层的代码规范和 TypeScript 配置已全面落地。
  2.  **后端服务搭建完毕:** Hono 服务器、Prisma 模型与首次迁移、tRPC 服务及第一个 `user.create` 接口均已完成并可正常工作。
  3.  **前后端契约建立:** 创建了独立的 `@health-dietary/api` 包，成功解耦了 API 定义与实现。
  4.  **双前端应用搭建完毕:** `client-react` 和 `client-vue` 均已初始化，并配置好了各自生态的最佳 tRPC 集成方案。
  5.  **全链路技术验证:** 已成功从前端发起 API 调用，数据流经全栈并成功持久化到数据库，验证了整个技术栈的可行性。

- **2.2. 当前状态:**
  项目正处于一个**“基础设施完备，待功能开发”**的阶段。我们拥有了一个极其稳固和高效的开发平台，可以立即投入核心业务功能的开发。

---

## **第三部分：下一阶段开发内容规划**

接下来的任务将围绕**完善统一配置管理**和**实现核心业务功能**两个核心展开。

- **3.1. 统一配置管理 (高优先级)**
  - **目标:** 消除项目中的硬编码配置（如端口、URL），实现集中管理。
  - **行动计划:**
    1.  创建一个新的共享包 `packages/config`。
    2.  使用 `zod` 在该包中定义环境变量的 schema，确保类型安全。
    3.  后端 (`server`) 和前端 (`client-*`) 从此包导入配置（如 `PORT`, `API_URL`），不再硬编码。
    4.  在**项目根目录**创建 `.env` 文件作为所有环境变量的唯一来源。

- **3.2. 核心业务功能开发 (按模块)**
  - **模块一：用户认证与管理**
    1.  **后端:** 实现 `register`, `login` 接口；引入 `bcrypt` 进行密码加密；引入 `JWT` 或 Session 实现登录状态管理；创建 `protectedProcedure` 以保护需要授权的接口。
    2.  **前端:** 创建注册/登录页面及路由；实现 API 调用逻辑；使用全局状态管理（Zustand/Pinia）存储用户信息；实现路由守卫。

  - **模块二：健康档案与数据追踪**
    1.  **后端:** 实现健康档案的 CRUD 接口；实现 BMR/TDEE 计算逻辑。
    2.  **前端:** 创建健康档案设置页面；创建数据日常记录界面；使用图表库进行数据可视化。

  - **模块三：食谱库与膳食计划**
    1.  **后端:** 定义 `Recipe`, `Ingredient` 等 Prisma 模型；实现食谱库的 CRUD 与搜索接口；实现初步的膳食计划生成算法。
    2.  **前端:** 创建食谱浏览、搜索、详情页面；创建膳食计划展示与管理界面。

---

## **第四部分：AI 编程代理 (`Agent`) 指令**

### **Agent 名称:** `健康饮食项目架构师`

### **核心使命:**

本代理的核心使命是基于本文档中定义的架构、技术和原则，协助开发者高效、高质量地完成“健康饮食”项目的编码工作。**所有产出的代码和配置都必须严格遵守本文档的规范。**

### **知识库:**

本文档是你的**唯一事实来源**。在执行任何任务前，请务必参考相关章节。

### **核心指令与行为准则:**

1.  **遵循依赖流:** 在添加任何 API 功能时，必须遵循 **`packages/api` (定义) -> `apps/server` (实现) -> `apps/client-*` (消费)** 的流程。严禁破坏此规则。
2.  **坚持类型安全:** 所有函数、API 接口、组件 Props 都必须有明确的 TypeScript 类型。优先使用 Prisma 和 Zod 自动生成的类型。
3.  **使用正确的工具:**
    - 创建后端 API，必须使用 tRPC 的 `router` 和 `procedure`。
    - 与数据库交互，必须通过 `Context` (`ctx.db`) 使用 Prisma Client。
    - 在 React 中获取/修改数据，必须使用 `@trpc/react-query` 提供的 Hooks。
    - 在 Vue 中获取/修改数据，必须组合使用 `@tanstack/vue-query` 和注入的 tRPC 客户端。
4.  **配置要集中:** 当需要添加新的环境变量或全局配置时，应优先考虑将其添加到 `packages/config`（待建）或根 `.env` 文件中，而不是在子项目中硬编码。
5.  **保持代码规范:** 所有生成的代码必须符合项目根目录定义的 ESLint 和 Prettier 规则。
6.  **优先使用共享模块:** 在编写新功能前，检查 `packages/*` 目录下是否已有可复用的工具函数或类型定义。
7.  **当存在疑问时:** 以本文档定义的原则为准。如果本文档未明确规定，应提出问题，而不是做出可能违反架构原则的假设。

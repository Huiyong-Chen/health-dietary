# Health-Dietary 项目规划文档

## 一、项目概述

构建一个智能、便捷、个性化的健康生活管理平台，通过整合饮食、运动和身体数据，帮助用户轻松达成健康目标，提升生活质量。

**项目定位**：个人学习项目，旨在通过完整的全栈开发实践，建立系统化的项目构建经验。

---

## 二、功能需求

### 2.1 核心功能模块

#### 1. 用户认证与管理

- 用户注册、登录、密码重置
- 个人资料管理（头像、昵称）
- **登录策略**：
  - 同设备类型：单点登录（新登录踢出旧会话）
  - 跨设备类型：支持多端同时在线
- JWT Token 认证 + API 限流

#### 2. 健康档案与数据追踪

- **健康档案**：身高、体重、年龄、性别、活动水平、饮食偏好、过敏信息、健康目标
- **数据记录**：
  - 优先：文件导入（前期支持 JSON，后期扩展 Apple Health XML、华为 JSON 等）
  - 手动：每日体重、食物摄入、运动量
- **健康指标**：自动计算 BMR（基础代谢率）和 TDEE（总日常能量消耗）
- **数据可视化**：图表展示体重、卡路里、运动量历史趋势

#### 3. 食谱库与智能推荐

- **食谱浏览**：按分类、食材、卡路里筛选
- **智能推荐**：
  - 前期：基于健康目标、偏好、过敏信息的规则过滤
  - 后期：协同过滤算法（基于用户行为）
- **食谱详情**：配料、步骤、营养信息
- **交互**：收藏、评分

#### 4. 膳食计划管理

- **自动生成**：根据用户目标生成周/日膳食计划
- **手动调整**：替换计划中的食谱
- **膳食打卡**：记录完成情况，自动更新卡路里摄入

#### 5. 运动计划与追踪

- **运动库**：常见运动及卡路里消耗估算
- **运动记录**：类型、时长、强度
- **进度可视化**：运动量和消耗趋势

#### 6. 食材库存与购物清单

- **库存管理**：记录现有食材
- **购物清单**：根据膳食计划自动生成

#### 7. 通知与提醒系统

- **应用内通知**：页面弹窗、消息中心
- **浏览器原生通知**：Web Notification API（需用户授权）
- **提醒类型**：体重记录、膳食计划、运动计划
- **技术方案**：定时任务 + WebSocket/轮询推送

#### 8. 健康报告

- 生成周/月度报告，总结数据并提供建议

### 2.2 补充功能

#### 9. 数据导入/导出

- **导出**：JSON/CSV 格式备份
- **导入**：前期支持 JSON，后期扩展多设备格式

#### 10. 营养成分数据库

- 基础食材营养信息表（蛋白质、碳水、脂肪、维生素等）
- 支撑食谱营养计算和智能推荐

#### 11. 目标进度追踪

- 里程碑设定（目标体重、体脂率）
- 进度百分比、预计达成时间可视化

#### 12. 单位换算

- 支持多种计量单位（克/磅、千卡/千焦）
- 用户偏好设置

#### 13. 快速记录

- 常用食物/运动收藏
- 历史记录快速复用

#### 14. 离线支持

- 核心数据本地缓存（IndexedDB）
- 离线记录、联网同步（Service Worker + 后台同步 API）

#### 15. 日志系统

- 用户行为日志、错误追踪
- 学习日志架构与调试实践

#### 16. 多语言支持（i18n）

- 中英文切换
- 学习国际化方案

#### 17. 深色模式

- 主题切换（CSS 变量 + localStorage 持久化）

#### 18. 数据统计面板

- 管理员视角：总用户数、活跃度、热门食谱

---

## 三、技术栈

### 3.1 前端技术栈

| 技术                              | 选择理由                                                                                                                     |
| --------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| **React + Vue**                   | **双框架实现**：React 学习生态丰富的组件化开发，Vue 学习渐进式框架与 Composition API；对比两者开发体验与设计哲学             |
| **Framework7**                    | **移动端 UI 框架**：提供原生 App 风格组件（滑动手势、导航栏、底部标签），适合健康管理类移动应用场景                          |
| **Tailwind CSS**                  | **实用优先 CSS**：快速开发定制化样式，补充 Framework7 未覆盖的 UI 需求，减少手写 CSS                                         |
| **TypeScript**                    | **类型安全**：配合 tRPC 实现端到端类型推断，减少运行时错误，提升代码可维护性                                                 |
| **Vite**                          | **现代构建工具**：极速热更新（原生 ESM）、开箱即用的 TS 支持、优化的生产构建，学习下一代工具链                               |
| **React Router / Vue Router**     | **官方路由方案**：成熟稳定，处理页面跳转、嵌套路由、路由守卫                                                                 |
| **Zustand / Pinia**               | **轻量状态管理**：React 用 Zustand（简单 API、无 Boilerplate），Vue 用 Pinia（官方推荐、类型友好），避免 Redux/Vuex 的复杂性 |
| **Chart.js / Recharts / ECharts** | **数据可视化**：实现体重、卡路里趋势图表，学习数据呈现方案                                                                   |
| **date-fns / Day.js**             | **日期处理**：轻量级时间库，处理膳食计划、提醒时间计算                                                                       |

### 3.2 后端技术栈

| 技术               | 选择理由                                                                                                        |
| ------------------ | --------------------------------------------------------------------------------------------------------------- |
| **Node.js**        | **全栈 JavaScript/TypeScript**：前后端语言统一，降低学习成本，利于类型共享                                      |
| **Hono**           | **轻量高性能框架**：类 Express API 但更快，原生支持 TypeScript，边缘计算友好，学习现代 Web 框架设计             |
| **SQLite**         | **轻量嵌入式数据库**：无需独立部署，适合个人学习项目，文件存储易于备份迁移                                      |
| **Prisma**         | **现代 ORM**：类型安全的数据库操作，自动生成类型定义，可视化 Schema 管理（Prisma Studio），学习数据建模最佳实践 |
| **tRPC + Zod**     | **端到端类型安全**：前后端共享类型定义，无需手写 API 类型；Zod 提供运行时校验，学习类型驱动开发                 |
| **Winston / Pino** | **日志库**：结构化日志、日志分级、文件轮转，学习生产级日志实践                                                  |
| **node-cron**      | **定时任务**：实现提醒系统的定时检查与推送                                                                      |

### 3.3 工程化工具

| 技术                   | 选择理由                                                                                           |
| ---------------------- | -------------------------------------------------------------------------------------------------- |
| **pnpm**               | **高效包管理器**：节省磁盘空间（硬链接共享依赖），monorepo 友好，安装速度快                        |
| **ESLint**             | **代码质量检查**：发现潜在 bug、强制编码规范，配合插件支持 React/Vue 特性检查                      |
| **Prettier**           | **代码格式化**：统一代码风格（缩进、引号、换行），避免团队协作争议（虽是个人项目，但学习标准流程） |
| **Husky**              | **Git 钩子管理**：pre-commit 自动运行 lint/format，确保提交代码质量                                |
| **commitlint**         | **规范提交信息**：强制 Git Commit Message 格式，学习语义化版本控制                                 |
| **Vitest**（可选）     | **单元测试**：与 Vite 深度集成，极速测试体验，学习测试驱动开发                                     |
| **Playwright**（可选） | **E2E 测试**：跨浏览器端到端测试，学习自动化测试                                                   |

### 3.4 推荐项目架构（Monorepo）

```
health-dietary/
├── apps/
│   ├── web-react/        # React前端（Vite + React + Framework7）
│   ├── web-vue/          # Vue前端（Vite + Vue + Framework7）
│   └── server/           # Node.js后端（Hono + Prisma）
├── packages/
│   ├── shared/           # 共享类型、工具函数
│   ├── trpc/             # tRPC路由定义
│   └── ui/               # 共享UI组件（可选）
├── prisma/               # 数据库Schema
├── .husky/               # Git钩子配置
├── pnpm-workspace.yaml   # pnpm工作空间配置
├── package.json          # 根配置
├── .eslintrc.js          # ESLint配置
├── .prettierrc           # Prettier配置
└── tsconfig.json         # 全局TypeScript配置
```

**架构优势**：

- **类型共享无缝**：前后端通过`packages/shared`共享类型定义
- **依赖统一管理**：pnpm workspace 统一版本，避免重复安装
- **模块化开发**：前端双实现独立开发，共享后端 API

---

## 四、开发阶段规划

| 阶段        | 功能范围                                         | 预计时间 | 学习目标                                      |
| ----------- | ------------------------------------------------ | -------- | --------------------------------------------- |
| **Phase 1** | 项目搭建、用户认证、健康档案、手动数据记录       | 2-3 周   | 掌握 Monorepo 架构、JWT 认证、Prisma 数据建模 |
| **Phase 2** | 食谱库、简单推荐、膳食计划、运动追踪、数据可视化 | 3-4 周   | 学习复杂查询、图表库集成、业务逻辑设计        |
| **Phase 3** | 库存管理、购物清单、提醒系统、快速记录、目标追踪 | 2-3 周   | 实现定时任务、WebSocket/通知推送              |
| **Phase 4** | 文件导入、离线支持、协同过滤推荐、健康报告       | 2-3 周   | 学习文件解析、Service Worker、推荐算法        |
| **Phase 5** | 深色模式、i18n、日志系统、统计面板、优化         | 1-2 周   | 完善工程化、性能优化、生产级特性              |

---

## 五、技术实现要点

### 5.1 同设备单点登录

- JWT Payload 存储`deviceType`（通过 User-Agent 解析）
- Redis/内存存储映射：`userId_deviceType -> token`
- 新登录时失效同类设备旧 token

### 5.2 智能推荐算法

- **阶段 1**：规则过滤（健康目标 + 偏好 + 过敏 + 卡路里范围）
- **阶段 2**：协同过滤（用户-食谱评分矩阵 → 余弦相似度/矩阵分解）

### 5.3 离线支持

- Service Worker 缓存静态资源
- IndexedDB 存储用户数据
- Background Sync API 实现联网同步

### 5.4 文件导入解析

- 后端适配器模式：统一接口 + 多格式解析器
- 前期：JSON 格式
- 后期：Apple Health XML、华为 JSON、小米 CSV

---

## 六、核心学习价值

1. **全栈技能树**：前端双框架 + Node.js 后端 + 数据库设计
2. **类型安全实践**：TypeScript + tRPC + Prisma 端到端类型系统
3. **现代工程化**：Monorepo + ESLint + Husky + pnpm
4. **业务建模能力**：健康管理领域的数据结构设计与业务逻辑实现
5. **高级特性**：离线支持、推荐算法、实时通知、国际化
6. **生产级思维**：日志、限流、安全、测试

---

**文档版本**：v1.0  
**最后更新**：2025-10-31
